# Сервис получения информации о товарах Wildberries с фильтрацией по цвету и цене.

Асинхронное Django 5.2-приложение для получения товарных карточек с wildberries.ru. Проект максимально очищен от неиспользуемых возможностей Django, (нет даже, базы данных!) и запускается на uvicorn (ASGI).

## Особенности

- полностью асинхронный скрейпинг с использованием httpx;
- минималистическая конфигурация Django;
- фильтрация результатов названию категории товаров, диапазону цен и цвету;
- JSON API, подходит для автоматизации и интеграций.

## Установка

1. Клонируйте репозиторий.
2. Создайте виртуальное окружение и установите зависимости:
   ```bash
   python -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```
3. Для старта перейдите в папку src и выполните команду запуска сервера::
   ```bash
   uvicorn config.asgi:application
   ```
4. Для получения информации вызовите GET ```http://127.0.0.1:8000/api/parser/``` с параметрами, которые описаны ниже. 

## Использование API

### `GET /api/parser/`

Параметры запроса:

| name      | type   | description                                                |
|-----------|--------|------------------------------------------------------------|
| `search`  | str    | **Обязательный.** Фраза для поиска товара, отправляемая в Wildberries.          |
| `page`    | int    | Номер страницы. По умолчанию: `1`. Должен быть положительным числом (необязательно).              || 
| `min`     | int    | Минимальная цена в рублях (необязательно).                        |
| `max`     | int    | 	Максимальная цена в рублях (необязательно).                      |
| `color`   | str    | Список названий цветов на русском, через запятую (например, "красный,черный"). Допустимы только те цвета, которые определены в wb_constants.py. |

Пример запроса:

```bash
http://127.0.0.1:8000/api/parser/?search=джинсы&min=100000&max=500000&color=черный,синий&page=2
```

Есть еще параметр per_page, с помощью которого можно регулировать количество scu на странице. Во избежания "дыр"и "повторов", этот параметр жестко фиксируется в константе `PER_PAGE`, но при необходимости можно легко внести этот параметр в запрос.

### Response

Эндпоинт возвращает JSON следующего вида:

```json
{
  "page": 1,
  "per_page": 20,
  "returned": 20,
  "products": [...],
  "total_filtered_so_far": 40,
  "wb_pages_fetched": 2
}
```

- `products` - список товаров, возвращенных Wildberries, соответствующих фильтрам.
- `total_filtered_so_far` - указывает, сколько всего товаров удовлетворяют фильтрам.
- `wb_pages_fetched` указывает, сколько страниц Wildberries было запрошено для сбора данных.



## Методология фильтрации по цене

При фильтрации товаров по цене учитывается не просто обычная цена или цена со скидкой, а вычисляется «реальная» цена для покупателя. Для этого из значения `salePriceU` (цена со скидкой в копейках) вычитается `logisticsCost` (складская скидка Wildberries). Полученное значение делится на 100 для перевода в рубли.
Такой подход максимально соответствует цене, которая отображается в карточке товара на сайте Wildberries, если не использовать внутренний кошелёк WB.
